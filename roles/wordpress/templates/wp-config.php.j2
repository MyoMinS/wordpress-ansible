<?php
define('DB_NAME', '{{ mysql_wordpress_db }}');
define('DB_USER', '{{ mysql_wordpress_user }}');
define('DB_PASSWORD', '{{ mysql_wordpress_password }}');
define('DB_HOST', 'localhost');
define('DB_CHARSET', 'utf8mb4');
define('DB_COLLATE', '');

define( 'AUTH_KEY',         '{{ lookup('password', '/dev/null chars=ascii_letters,digits,punctuation length=64') }}' );
define( 'SECURE_AUTH_KEY',  '{{ lookup('password', '/dev/null chars=ascii_letters,digits,punctuation length=64') }}' );
define( 'LOGGED_IN_KEY',    '{{ lookup('password', '/dev/null chars=ascii_letters,digits,punctuation length=64') }}' );
define( 'NONCE_KEY',        '{{ lookup('password', '/dev/null chars=ascii_letters,digits,punctuation length=64') }}' );
define( 'AUTH_SALT',        '{{ lookup('password', '/dev/null chars=ascii_letters,digits,punctuation length=64') }}' );
define( 'SECURE_AUTH_SALT', '{{ lookup('password', '/dev/null chars=ascii_letters,digits,punctuation length=64') }}' );
define( 'LOGGED_IN_SALT',   '{{ lookup('password', '/dev/null chars=ascii_letters,digits,punctuation length=64') }}' );
define( 'NONCE_SALT',       '{{ lookup('password', '/dev/null chars=ascii_letters,digits,punctuation length=64') }}' );

$table_prefix = 'wp_';

// Behind ALB/HTTPS
if (isset($_SERVER['HTTP_X_FORWARDED_PROTO']) && $_SERVER['HTTP_X_FORWARDED_PROTO'] == 'https') {
    $_SERVER['HTTPS'] = 'on';
}

// Security hardening
define('DISALLOW_FILE_EDIT', true);
define('DISALLOW_FILE_MODS', true);
define('FORCE_SSL_ADMIN', {{ 'true' if environment == 'production' else 'false' }});
define('WP_POST_REVISIONS', 3);
define('AUTOSAVE_INTERVAL', 300);
define('WP_MEMORY_LIMIT', '256M');

// Environment-specific debug
define('WP_DEBUG', {{ wordpress_debug | default('false') }});
define('WP_DEBUG_LOG', {{ wordpress_debug | default('false') }});
define('WP_DEBUG_DISPLAY', false);
define('SCRIPT_DEBUG', {{ wordpress_debug | default('false') }});

// Redis configuration
define('WP_REDIS_HOST', '127.0.0.1');
define('WP_REDIS_PORT', 6379);
define('WP_REDIS_TIMEOUT', 1);
define('WP_REDIS_DATABASE', 0);

// Cache and performance
define('WP_CACHE', true);
define('COMPRESS_CSS', true);
define('COMPRESS_SCRIPTS', true);
define('CONCATENATE_SCRIPTS', {{ 'true' if environment == 'production' else 'false' }});
define('EMPTY_TRASH_DAYS', 7);
define('WP_CRON_LOCK_TIMEOUT', 60);

// Security constants
define('AUTOMATIC_UPDATER_DISABLED', true);
define('WP_AUTO_UPDATE_CORE', false);
define('DISALLOW_UNFILTERED_HTML', true);
define('WP_HTTP_BLOCK_EXTERNAL', {{ 'true' if environment == 'production' else 'false' }});
ini_set('log_errors', 'On');
ini_set('display_errors', 'Off');

if ( !defined('ABSPATH') )
    define('ABSPATH', dirname(__FILE__) . '/');

require_once(ABSPATH . 'wp-settings.php');
